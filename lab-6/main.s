Stack_Size EQU 0x400
bottom_of_stack EQU 0x20000000
top_of_stack EQU bottom_of_stack + Stack_Size
SYSTICK_BASE EQU 0xE000E010
STK_CTRL EQU 0
STK_LOAD EQU 4
STK_VAL EQU 8
STK_CTRL_CLKSOURSE EQU 4
STK_CTRL_TICKINT EQU 2
STK_CTRL_ENABLE EQU 1
	
	AREA RESET, DATA, READONLY
	DCD top_of_stack
	DCD Start
	DCD 0
	DCD 0
	DCD 0
	DCD 0
	DCD 0
	DCD 0
	DCD 0
	DCD 0
	DCD 0
	DCD 0
	DCD 0
	DCD 0
	DCD 0
	DCD ISR_SYSTICK
		
	AREA MY_CODE, CODE, READONLY
	EXTERN RCC_INIT
		
	ENTRY
ISR_SYSTICK PROC
	add r5, r5, #1
	cmp r5, r6
	bcs finish
	BX LR
	ENDP
		
SYSTICK_START PROC
	LDR R0 , =SYSTICK_BASE
	LDR R1 , =24000 - 1
	STR R1 ,[R0 , #STK_LOAD]
	LDR R1, [R0 , #STK_VAL]
	BIC R1, R1, #0x00FFFFFF
	STR R1, [R0 , #STK_VAL]
	
	LDR R1, [R0 , #STK_CTRL]
	ORR R1, R1, #(STK_CTRL_CLKSOURSE + STK_CTRL_TICKINT + STK_CTRL_ENABLE)
	STR R1, [R0 , #STK_CTRL]
	BX LR
	ENDP
		
Start PROC
	mov r5, #0
	mov r6, #2745
	BL RCC_INIT
	BL SYSTICK_START
	
while 
	nop
	b while
	
finish
	nop
	ENDP
	END